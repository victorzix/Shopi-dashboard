<div class="cursor-default w-full flex flex-wrap gap-1 items-center">
  <ng-container *ngIf="subCategories && subCategories.length > 0">
    <div
      class="w-6 h-6 rounded-full cursor-pointer hover:bg-orange-500 transition-all ease-in-out duration-200 hover:scale-110 bg-orange-600 text-white flex items-center justify-center text-sm"
      [brnMenuTriggerFor]="createSubCategoryMenu"
    >
      +
    </div>
  </ng-container>

  <app-create-subcategory-form #createSubCategoryMenu />

  <ng-container *ngIf="!isSubCategoriesLoading; else skeleton">
    <ng-container
      *ngIf="subCategories && subCategories.length; else emptyState"
    >
      <button
        *ngFor="let sub of subCategories; let i = index"
        [class]="{
          'bg-gray-300 hover:bg-gray-500': !sub.visible,
          'bg-orange-500 hover:bg-orange-600': sub.visible
        }"
        hlmBadge
        [brnPopoverTriggerFor]="subCategoryMenu"
      >
        {{ sub.name }}

        <brn-popover sideOffset="5" #subCategoryMenu>
          <div
            hlmPopoverContent
            *brnPopoverContent="let ctx"
            class="min-h-56 bg-white shadow-xl border-1 border-gray p-4 rounded-lg"
          >
            <form
              [formGroup]="updateSubCategoryForm"
              class="flex flex-col gap-2"
            >
              <label hlmLabel for="name">
                Nome
                <input
                  name="name"
                  formControlName="name"
                  type="text"
                  hlmInput
                  class="h-10 rounded-sm border-1 border-gray-400"
                  [(ngModel)]="sub.name"
                />
              </label>

              <label hlmLabel for="description">
                Descrição
                <textarea
                  type="text"
                  name="description"
                  formControlName="description"
                  hlmInput
                  class="min-h-22 rounded-sm border-1 border-gray-400 text-xs"
                  [(ngModel)]="sub.description"
                ></textarea>
              </label>

              <label
                hlmLabel
                for="visible"
                class="flex flex-col gap-2 py-2 w-full"
              >
                Visibilidade
                <button
                  class="py-2 text-white rounded-md cursor-pointer hover:scale-105 transition-scale ease-in-out duration-300 disabled:bg-gray-500 disabled:hover:scale-100 disabled:cursor-not-allowed"
                  [class]="sub.visible ? 'bg-green-600' : 'bg-red-600'"
                  type="button"
                  (click)="changeSubCategoryVisibility(sub)"
                  [disabled]="isVisibilityLoading"
                >
                  <hlm-spinner *ngIf="isVisibilityLoading" class="h-4 w-4" />

                  <span *ngIf="!isVisibilityLoading"
                    >{{ sub.visible ? "Ativo" : "Não ativo" }}
                  </span>
                </button>
              </label>

              <div class="flex gap-2 justify-between w-full">
                <button
                  type="button"
                  class="bg-red-600 text-xs rounded-xl p-2 text-white w-2/4 cursor-pointer hover:scale-105 shadow-lg transition-scale ease-in-out duration-300 disabled:bg-gray-500 disabled:hover:scale-100 disabled:cursor-not-allowed"
                  (click)="deleteSubCategory(sub)"
                  [disabled]="isFormPristine(sub) || isUpdateLoading"
                >
                  <hlm-spinner *ngIf="isDeleting" class="w-3 h-3"/>
                  <span *ngIf="!isDeleting">
                    {{ isDeleteButtonPressed ? "Confirmar" : "Excluir" }}
                  </span>
                </button>
                <button
                  type="button"
                  class="flex justify-center items-center bg-orange-600 text-xs rounded-xl p-2 text-white w-4/6 cursor-pointer hover:scale-105 shadow-lg transition-scale ease-in-out duration-300 disabled:bg-gray-500 disabled:hover:scale-100 disabled:cursor-not-allowed"
                  [disabled]="
                    isFormPristine(sub) ||
                    updateSubCategoryForm.controls.name.invalid ||
                    isUpdateLoading
                  "
                  (click)="updateSubCategory(sub)"
                >
                  <span *ngIf="isUpdateLoading"
                    ><hlm-spinner class="w-3 h-3"
                  /></span>
                  <span *ngIf="!isUpdateLoading">Salvar</span>
                </button>
              </div>
            </form>
          </div>
        </brn-popover>
      </button>
    </ng-container>
  </ng-container>
</div>
<ng-template #skeleton>
  <hlm-skeleton
    *ngFor="let _ of [].constructor(8); let i = index"
    class="bg-gray-300 h-6 w-16 rounded-full"
  />
</ng-template>

<ng-template #emptyState>
  <div class="w-full flex flex-col justify-center items-center py-2 gap-2">
    <span class="text-gray-500 italic">Nenhuma subcategoria encontrada.</span>
    <div
      class="w-12 h-12 rounded-full cursor-pointer hover:bg-orange-500 transition-all ease-in-out duration-200 hover:scale-110 bg-orange-600 text-white flex items-center justify-center text-lg"
      [brnMenuTriggerFor]="createSubCategoryMenu"
    >
      +
    </div>
  </div>
</ng-template>
